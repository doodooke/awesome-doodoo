## 环境准备
1. 推荐服务器操作系统为ubuntu 16.04版本
2. 推荐安装使用node 8.12.0，yarn 1.5.1，mysql 5.7，redis 4.0.9
3. 根据说明安装我们编译的node环境，地址：https://github.com/doodooke/node
4. 序列号 

## api安装
> 说明：
1. doodoo-core为doodoo核心文件，不可删除。
2. 后缀为.js7文件为doodoo版权文件，依赖doodoo-core允许。
3. 序列号LICENSE.key文件为doodoo授权文件，不可删除。

> 配置：
```
# 应用配置
APP_PORT=3001
APP_HOST=http://127.0.0.1:3001

# 验证码
VERIFY_MAXIP=36 		//验证码最大ip限制
VERIFY_MAXPHONE=6 		//验证码最大个数限制

# MYSQL数据库链接
MYSQL=true				
MYSQL_HOST=127.0.0.1 		//服务器地址
MYSQL_USER=root 		//用户名
MYSQL_PASSWORD=root 		//密码
MYSQL_DATABASE=doodoo 		//数据库名
MYSQL_PORT=3306 		//端口
MYSQL_CHARSET=utf8mb4 		//数据库编码

# REDIS链接
REDIS=true 		 		//开启
REDIS_HOST=127.0.0.1 		//主机地址
REDIS_PORT=6379 		//端口
REDIS_PREFIX=xxx 		//前缀

# 七牛云 https://www.qiniu.com/
QINIU=false 		 		//七牛云开启true，关闭false
QINIU_ACCESSKEY=xxx 		//个人中心-密钥管理-AccessKey
QINIU_SECRETKEY=xxx 		//个人中心-密钥管理-SecretKey
QINIU_BUCKET=xxx 		//存储空间名
QINIU_DOMAIN=xxx 		//七牛云存储域名

# 分页
PAGE_SIZE=20 		 		//分页，每页显示数据个数

# jwt配置 https://www.npmjs.com/package/jsonwebtoken
JWT_SECRET=xxx 		//密钥，自己设置
JWT_EXPIRESIN=7 days 		//过期时间

# 微信开放平台 https://open.weixin.qq.com/
OPEN_APPID=xxx 		//管理中心-第三方平台-创建第三方-AppID
OPEN_APPSECRET=xxx 		//管理中心-第三方平台-创建第三方-AppSecret
OPEN_TOKEN=xxx 		//消息校验Token
OPEN_ENCODINGAESKEY=xxx 		//消息加解密Key

授权登录相关
登录授权的发起页域名 		xx.com
授权测试公众号列表 		xxxxx
授权事件接收URL 		http://xx.com/app/home/wxa/open/wxaNotice

授权后实现业务
消息校验Token 		doodooke
消息加解密Key 		xxxxxxxxx
消息与事件接收URL 		http://xx.com/app/home/wxa/open/wxaMsg/$APPID$
小程序服务器域名 		xx.com
小程序业务域名 		xx.com

# 微信服务号 https://mp.weixin.qq.com
WX_APPID=xxx 		//开发-基本配置-开发者ID(AppID)
WX_APPSECRET=xxx 		//开发-基本配置-开发者密码(AppSecret)
WX_TOKEN=xxx 		//开发-基本配置-令牌(Token)
WX_ENCODINGAESKEY=xxx 		//开发-基本配置-消息加解密密钥(EncodingAESKey)

# 支付宝支付
ALIPAY_ACCOUNT=xxx 		//商户号
ALIPAY_PARTNER=xxx 		//合作身份者ID，以2088开头由16位纯数字组成的字符串
ALIPAY_KEY=xxx 		//MD5密钥

# 阿里云短信
ALISMS_APPKEY=xxx 		//AccessKey ID
ALISMS_APPSECRET=xxx 		//Access Key Secret
ALISMS_FREE_SIGN_NAME=xxx 		//签名名称
ALISMS_TEMPLATE_CODE=xxx 		//模版CODE

尊敬的用户, 您的验证码是${code}，请及时输入验证码完成操作。
```

### docker方式安装（推荐）
```
# 更新依赖
apt update

# 安装docker
apt install -y docker.io
apt install -y docker-compose

# 创建docker network
docker network create doodoo

# 安装redis
docker run -p 6379:6379 --restart always --name redis --net doodoo -d redis

# 安装mysql
docker run -p 3306:3306 --restart always -v /etc/localtime:/etc/localtime:ro -e MYSQL_ROOT_PASSWORD=[数据库密码] -v ~/mysql/data:/var/lib/mysql -v ~/mysql/log:/var/log/mysql -v ~/mysql/conf:/var/log/conf.d --name mysql --net doodoo -d einsqing/mysql:1

# 安装nginx-proxy
docker run -p 80:80 -p 443:443 --restart always -v /var/run/docker.sock:/tmp/docker.sock:ro -v ~/nginx-proxy/certs:/etc/nginx/certs:ro -v ~/nginx-proxy/vhost.d:/etc/nginx/vhost.d -v ~/nginx-proxy/html:/usr/share/nginx/html -d --name nginx-proxy -e DEFAULT_HOST=_ --net doodoo einsqing/nginx-proxy:4

# 安装jrcs/letsencrypt-nginx-proxy-companion
docker run -d --restart always -v ~/nginx-proxy/certs:/etc/nginx/certs:rw --volumes-from nginx-proxy -v /var/run/docker.sock:/var/run/docker.sock:ro --name letsencrypt-nginx-proxy-companion jrcs/letsencrypt-nginx-proxy-companion
```

```
# 构建doodoo-api
docker build -t doodoo-api:1 ./

# 启动doodoo-api
docker run --restart always -v /etc/localtime:/etc/localtime:ro --name doodoo-api --link mysql --link redis -v ~/backup/doodoo-api:/www/backup -e VIRTUAL_HOST=[你的域名] -e LETSENCRYPT_HOST=[你的域名] -e LETSENCRYPT_EMAIL=[你的邮箱] --net doodoo -d doodoo-api:1
```
### 直接安装
1. 安装redis（略）
2. 安装mysql（略）
3. 安装nginx（略）
4. 进入doodoo-api根目录，执行命令安装依赖`yarn install`，执行命令启动`pm2 start pm2.json`

## ssr安装
### docker方式安装（推荐）
```
# 构建doodoo-ssr
docker build -t doodoo-ssr:1 ./

# 启动doodoo-ssr
docker run --restart always --name doodoo-ssr -e VIRTUAL_HOST=[你的域名] -e LETSENCRYPT_HOST=[你的域名] -e LETSENCRYPT_EMAIL=[你的邮箱] --net doodoo -d doodoo-ssr:1
```
### 直接安装
1. 进入doodoo-ssr目录，执行命令安装依赖`yarn install`，执行命令编译`npm run build`，执行命令启动`pm2 start pm2.json`

## wxa安装
通过微信小程序编辑器上传到开放平台，获取模版id，然后设置到超管